---
title: "Generation of figures for BrainCharter"
author: "Ben Barry"
date: "06/07/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

load libraries
```{r}
library(tidyverse)
library(ggbeeswarm)
library(factoextra)
library(dbscan)
library(BiocManager)
library(cluster)
library(factoextra)
library(magrittr)
library(ggplot2)
library(tidyr)
library(readxl)
library(tidyverse)
library(abind)
library(dbscan)
library(ggplot2)
library(ggrepel)
library(ggpubr)
```

Load data sets
```{r}
ABA_zscore <- read.delim("../data/ABA_zscore.txt")
data_backup <- ABA_zscore


ABA_median <- read_tsv("../data/ABA_median.txt")
data_backup <- ABA_median

```

A20 TLR4 cluster plot
```{r}
#setting up a data table 

A20_TLR4<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TLR4", "TNFAIP3")]

A20_TLR4c <- A20_TLR4[c("structure_acronym","TLR4", "TNFAIP3")]

rownames(A20_TLR4c) <- A20_TLR4c$structure_acronym
A20_TLR4c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(A20_TLR4c, k =2)
abline(h = 0.5, lty = 2)
#dbscan
dbs_A20_TLR4 <- dbscan(A20_TLR4c, eps = 0.5, minPts = 3)

# Visualize DBSCAN
A20_TLR4_DBS <- fviz_cluster(dbs_A20_TLR4, 
                           data = A20_TLR4c,
                           ellipse.type = "convex",
                           palette = LfAq_disc,
                           fill = "grey",
                           ggtheme = theme_classic(),
                           geom = c("point", "text"),
                           show.clust.cent = FALSE,
                           repel = FALSE,
                           xlim = c(-4, 3),
                           ylim = c(-5, 5),
                           xticks.by = 2,
                           yticks.by = 1,
                           pointsize = 2,
                           labelsize = 0,
                           outlier.labelsize = 10.0,
                           outlier.pointsize = 2,
                           outlier.color = "black",
                           ellipse.alpha = 0.2,
                           cor.coef = FALSE,
                           cor.method = "spearman",
                           cor.coef.coord = c(-4, 4),
                           conf.int = FALSE,
                           font.x = 15,
                           font.y = 15,
                           font.tickslab = c(12, "bold", "black"),
                           ellipse.border.remove = FALSE,
                           add = c("none"),
                           add.params = list(color = "red"),
                            xlab = "TLR4 Expression (Z-score)",
                             ylab = "A20 Expression (Z-score)",
                             main = "")

A20_TLR4_DBS <- A20_TLR4_DBS +
  scale_x_continuous(breaks = seq(-4, 3, by = 1)) +
  scale_y_continuous(breaks = seq(-5, 5, by = 1)) +
  labs(title = "DBSCAN of TLR4 and A20 expression")

cluster1_points_A20TLR4 <- A20_TLR4c[dbs_A20_TLR4$cluster == 1,]
A20_TLR4_DBS <- A20_TLR4_DBS  +
  geom_smooth(data = cluster1_points_A20TLR4, 
              aes(x = TLR4, y = TNFAIP3),
              method = "lm",
              se = TRUE,
              color = "red",
              size = 0.5) +
stat_cor(data = cluster1_points_A20TLR4, 
         aes(x = TLR4, y = TNFAIP3), 
         method = "spearman", 
         label.x = -4, 
         label.y = 4, 
         size = 4, 
         face = "bold")
A20_TLR4_DBS


ggsave("TLR4vsA20dbscan.png", plot = A20_TLR4_DBS, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")

```

Kmeans scatter plot of A20_TLR4
```{r}
A20_TLR4_kmeans_clusters = fviz_nbclust(A20_TLR4c , kmeans, method = "silhouette")
A20_TLR4_kmeans_clusters

A20_TLR4_kmeans = kmeans(A20_TLR4c, centers = 2)

A20_TLR4_data_kmeans = A20_TLR4c %>%
  mutate(Cluster = factor(A20_TLR4_kmeans$cluster))


Kmeans_A20_TLR4 = ggplot(A20_TLR4_data_kmeans, aes(x = TLR4, y = TNFAIP3, color = Cluster)) +
  geom_point() +
  scale_color_manual(values = Darjeeling2) +
  theme_classic() + 
  labs(title = "Kmeans of A20 and TLR4 coexpression")
Kmeans_A20_TLR4
ggsave("A20TLR4kmeans.png", plot = Kmeans_A20_TLR4, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")
```

```{r}
hdbscan_A20_TLR4 <- hdbscan(A20_TLR4c, minPts = 5)
hdbscan_A20_TLR4$cluster

A20_TLR4_DBSCAN_data = A20_TLR4c %>%
  mutate(Cluster = factor(hdbscan_A20_TLR4$cluster))

ggplot(A20_TLR4_DBSCAN_data, aes(x = TLR4, y = TNFAIP3, color = Cluster)) +
  geom_point() +
  theme_classic()

```


generate a list of the outling regions 

```{r}
# Filter the row names based on the cluster assignments
outlier_acronyms <- rownames(A20_TLR4c)[dbs_A20_TLR4$cluster == 0]
cluster2_acronyms <- rownames(A20_TLR4c)[dbs_A20_TLR4$cluster == 2]
cluster3_acronyms <- rownames(A20_TLR4c)[dbs_A20_TLR4$cluster == 3]

# Convert structure acronyms to structure names
outlier_names <- ABA_ids$structure_name[ABA_ids$structure_acronym %in% outlier_acronyms]
cluster2_names <- ABA_ids$structure_name[ABA_ids$structure_acronym %in% cluster2_acronyms]
cluster3_names <- ABA_ids$structure_name[ABA_ids$structure_acronym %in% cluster3_acronyms]

# Print the structure names for outliers
print(outlier_names)

# Print the structure names for cluster 2
print(cluster2_names)

# Print the structure names for cluster 3
print(cluster3_names)

KNNdist_regions <- c(outlier_names, cluster2_names, cluster3_names)

KNNdist_regions_full <- c(outlier_acronyms, cluster2_acronyms, cluster3_acronyms) 

print(KNNdist_regions)
print(KNNdist_regions_full)
```


next use a scatterplot algorithm to identify regions

```{r}
# identfy threshold for A20 
hist(ABA_median$TNFAIP3,breaks=20)
#Cumulative distribution
plot(ecdf(ABA_median$TNFAIP3))
#Scatter plot
ggplot(data = ABA_median, aes(x=1,y=TNFAIP3))+
  geom_beeswarm()
#Violin
ggplot(data = ABA_median, aes(x=1,y=TNFAIP3))+
  geom_violin()


#Violin at higher (or lower) resolution
ggplot(data=ABA_median, aes(x=1,y=TNFAIP3))+
  geom_violin(bw=0.15)
```

#kmeans clustering
```{r}
kmdataA20 <- as.data.frame(ABA_median$TNFAIP3)
rownames(kmdataA20) <- ABA_median$structure_id


fviz_nbclust(kmdataA20, kmeans, method = "silhouette")


k2 <- kmeans(kmdataA20, centers = 2) #2 clusters
k2clust = kmdataA20 %>%
  mutate(Cluster = k2$cluster) #Output the cluster allocations
k2clust$structure_id <- ABA_median$structure_id
k2clust <- k2clust %>% 
  arrange(ABA_median$TNFAIP3)
ABA_medianA20 <- merge(ABA_median,k2clust[,2:3]) %>% 
  mutate(Cluster = as.factor(Cluster))

ggplot(data=ABA_medianA20, aes(x=1,y=TNFAIP3,colour=Cluster))+
  geom_beeswarm()

```
```{r}
# identfy threshold for TLR4 
# identfy threshold for TLR4 
hist(ABA_median$TLR4)
hist(ABA_median$TLR4,breaks=20)
#Cumulative distribution
plot(ecdf(ABA_median$TLR4))

#Scatter plot
ggplot(data = ABA_median, aes(x=1,y=TLR4))+
  geom_beeswarm()


#Violin
ggplot(data = ABA_median, aes(x=1,y=TLR4))+
  geom_violin()


#Violin at higher (or lower) resolution
ggplot(data=ABA_median, aes(x=1,y=TLR4))+
  geom_violin(bw=0.15)
```

#kmeans clustering
```{r}
kmdataTLR4 <- as.data.frame(ABA_median$TLR4)
rownames(kmdata) <- ABA_median$structure_id
fviz_nbclust(kmdataTLR4, kmeans, method = "wss",k.max = 50) 

fviz_nbclust(kmdataTLR4, kmeans, method = "silhouette")


k2 <- kmeans(kmdataTLR4, centers = 3) #2 clusters
k2clust = kmdataTLR4 %>%
  mutate(Cluster = k2$cluster) #Output the cluster allocations

k2clust$structure_id <- ABA_median$structure_id
k2clust <- k2clust %>% 
  arrange(ABA_median$TLR4)
ABA_medianTLR4 <- merge(ABA_median,k2clust[,2:3]) %>% 
  mutate(Cluster = as.factor(Cluster))
ggplot(data=ABA_medianTLR4, aes(x=1,y=TLR4,colour=Cluster))+
  geom_beeswarm()
```

Plot and label with parameters

```{r}
A20TLR4data <- ABA_median[c("structure_acronym", "structure_name", "TLR4", "TNFAIP3")]
rownames(A20TLR4data) <- A20TLR4data$structure_acronym
A20TLR4data$structure_acronym <- NULL


# Create the scatter plot
# Create the scatter plot
sp <- ggplot(A20TLR4data, aes(x = TLR4, y = TNFAIP3)) +
  geom_text(aes(label = ifelse(TLR4 > 7 | TNFAIP3 > 3, rownames(A20TLR4data), "")), 
            hjust = -0.21, vjust = -0.19) +
  geom_point(aes(color = ifelse((TLR4 > 7 | TNFAIP3 > 3) & (TLR4 > 6.5 & TNFAIP3 > 2.5), "olivedrab4",
                                ifelse((TLR4 > 7 | TNFAIP3 > 3) & (TLR4 > 6.5), "deepskyblue3",
                                       ifelse((TLR4 > 7 | TNFAIP3 > 3) & (TNFAIP3 > 2.5), "pink", "black"))))) +
  labs(x = "TLR4", y = "TNFAIP3") +
  scale_color_manual(values = c("black", "#3B9AB2", "#E1AF00", "#F21A00"),
                     labels = c("below threshold", "TLR4 high", "A20 high - TLR4 high", "A20 high"),
                     name = "") +
  ggtitle("") +
  theme_classic() + 
 geom_smooth(method = "lm", se = TRUE) +
  labs(x = "TLR4 expression", y = "A20 expression", size = 20, face = "bold", title = "Kmeans threasholding") +
  stat_cor(method = "spearman", label.x = 7, label.y = 5, size = 3, face = "bold")

sp
corA20TLR4 <- cor(A20TLR4data$TLR4, A20TLR4data$TNFAIP3, method = "spearman")
print(corA20TLR4)

ggsave("Kmeans threasholding_A20TLR4_scatterplot.png", plot = sp, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")




sp2 <- ggplot(A20TLR4data, aes(x = A20TLR4data$TLR4, y = A20TLR4data$TNFAIP3))+
geom_point(size = 1.5)+
ggtitle("") +
  theme_classic() + 
 geom_smooth(method = "lm", se = TRUE) +
  labs(x = "TLR4 expression", y = "A20 expression", size = 20, face = "bold", title = "A20 plotted against TLR4")  +
  stat_cor(method = "spearman", label.x = 7, label.y = 5, size = 3, face = "bold")

plot(sp2)

ggsave("basic_A20TLR4_scatterplot.png", plot = sp2, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")





kmeans_regions_acronym <- rownames(A20TLR4data)[A20TLR4data$TLR4 > 7 | A20TLR4data$TNFAIP3 > 3]
print(kmeans_regions)

# Filter the data based on the condition
filtered_data <- A20TLR4data[A20TLR4data$TLR4 > 7 | A20TLR4data$TNFAIP3 > 3, ]

# Print the list of structure names
kmeans_regions <- filtered_data$structure_name
print(kmeans_regions)
print(filtered_data)


```

#generate a vendiagram of the regions

```{r}
# Identify names in both lists
names_in_both <- intersect(kmeans_regions, KNNdist_regions)

# Identify names only in kmeans_regions
names_only_in_kmeans <- setdiff(kmeans_regions, KNNdist_regions)

# Identify names only in KNNdist_regions
names_only_in_KNNdist <- setdiff(KNNdist_regions, kmeans_regions)

# Print the results
print(names_in_both)
print(names_only_in_kmeans)
print(names_only_in_KNNdist)

# Identify names in both lists
names_in_both_ac <- intersect(kmeans_regions_acronym, KNNdist_regions_full)

# Identify names only in kmeans_regions
names_only_in_kmeans_ac <- setdiff(kmeans_regions_acronym, KNNdist_regions_full)

# Identify names only in KNNdist_regions
names_only_in_KNNdist_ac <- setdiff(KNNdist_regions_full, kmeans_regions_acronym)

print(names_in_both_ac)

print(names_only_in_kmeans_ac)

print(names_only_in_KNNdist_ac)


```

#correlte A20 and TRAF6 

```{r}
A20TRAF6data <- ABA_median[c("structure_acronym", "structure_name", "TRAF6", "TNFAIP3")]
rownames(A20TRAF6data) <- A20TLR4data$structure_acronym
A20TLR4data$structure_acronym <- NULL

ggplot(A20TRAF6data, aes(x = TRAF6, y = TNFAIP3)) +
  geom_point() +
  labs(x = "TRAF6", y = "TNFAIP3") +
  ggtitle("A20 vs TRAF6 Expression") +
  theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlation <- cor(A20TRAF6data$TRAF6, A20TRAF6data$TNFAIP3, method = "spearman")

# Print the correlation coefficient
cat("Correlation coefficient:", correlation, "\n")

# Create the scatter plot with regression line
A20TRAF6_SP = ggplot(A20TRAF6data, aes(x = TRAF6, y = TNFAIP3)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "TRAF6 expression (median)", y = "A20 expression (median)", size = 28) +
  stat_cor(method = "spearman", label.x = 5, label.y = 4, size = 3, face = "bold") +
  ggtitle("") +
  theme_classic()

A20TRAF6_SP
ggsave("A20TRAF6_SP.png", plot = A20TRAF6_SP, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")


## cluster plot 


A20_TRAF6<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TRAF6", "TNFAIP3")]

A20_TRAF6c <- A20_TRAF6[c("structure_acronym","TRAF6", "TNFAIP3")]

rownames(A20_TRAF6c) <- A20_TRAF6c$structure_acronym
A20_TRAF6c$structure_acronym <- NULL


#KNN dist plot 
dbscan::kNNdistplot(A20_TRAF6c, k =2)
abline(h = 0.8, lty = 2)

dbs_A20_TRAF6 <- dbscan(A20_TRAF6c, eps = 0.8, minPts = 3)

# Visualize
A20_TRAF6_DBS = fviz_cluster(dbs_A20_TRAF6, data = A20_TRAF6c,
                           ellipse.type = "convex",
                           palette = LfAq_disc,
                           fill = "grey",
                           ggtheme = theme_classic(),
                           geom = c("point", "text"),
                           show.clust.cent = FALSE,
                           repel = FALSE,
                           xlim = c(-5, 7),
                           ylim = c(-5, 5),
                           xticks.by = 2,
                           yticks.by = 1,
                           pointsize = 2,
                           labelsize = 0,
                           outlier.labelsize = 10.0,
                           outlier.pointsize = 2,
                           outlier.color = "black",
                           ellipse.alpha = 0.2,
                           cor.coef = TRUE,
                           cor.method = "spearman",
                           cor.coef.coord = c(-5, 4),
                           conf.int = TRUE,
                           font.x = 15,
                           font.y = 15,
                           font.tickslab = c(12, "bold", "black"),
                           ellipse.border.remove = FALSE,
                           add = c("reg.line"),
                           add.params = list(color = "red"),
                           xlab = "TRAF6 Expression (Z-score)",
                           ylab = "A20 Expression (Z-score)",
                           main = " ")
                           
A20_TRAF6_DBS
ggsave("A20_TRAF6_DBS.png", plot = A20_TRAF6_DBS, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



cluster1_points_A20TRAF6<- A20_TRAF6c[dbs_A20_TRAF6$cluster == 1, ]

correlation_cluster1_A20TRAF6 <- cor(cluster1_points_A20TRAF6$TRAF6, cluster1_points_A20TRAF6$TNFAIP3, method = "spearman")
correlation_cluster1_A20TRAF6


```



## A20 vs RIP1

```{r}

A20RIP1data <- ABA_median[c("structure_acronym", "structure_name", "RIPK1", "TNFAIP3")]
rownames(A20RIP1data) <- A20RIP1data$structure_acronym
A20RIP1data$structure_acronym <- NULL

A20RIP1_SP = ggplot(A20RIP1data, aes(x = RIPK1, y = TNFAIP3)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  stat_cor(method = "spearman", label.x = 5, label.y = 4, size = 3, face = "bold") +
  labs(x = "RIP1 expression (median)", y = "A20 expression (median)", size =28) +
  ggtitle("") +
  theme_classic()
A20RIP1_SP 
ggsave("A20_RIP1_SP.png", plot = A20RIP1_SP, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")


A20_RIP1<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "RIPK1", "TNFAIP3")]

A20_RIP1c <- A20_RIP1[c("structure_acronym","RIPK1", "TNFAIP3")]

rownames(A20_RIP1c) <- A20_RIP1c$structure_acronym
A20_RIP1c$structure_acronym <- NULL


#KNN dist plot 
dbscan::kNNdistplot(A20_RIP1c, k =2)
abline(h = 0.7, lty = 2)

dbs_A20_RIP1 <- dbscan(A20_RIP1c, eps = 0.7, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
A20_RIP1_DBS = fviz_cluster(dbs_A20_RIP1, data = A20_RIP1c,
                           ellipse.type = "convex",
                           palette = LfAq_disc,
                           fill = "grey",
                           ggtheme = theme_classic(),
                           geom = c("point", "text"),
                           show.clust.cent = FALSE,
                           repel = FALSE,
                           xlim = c(-5, 7),
                           ylim = c(-5, 5),
                           xticks.by = 2,
                           yticks.by = 1,
                           pointsize = 2,
                           labelsize = 0,
                           outlier.labelsize = 10.0,
                           outlier.pointsize = 2,
                           outlier.color = "black",
                           ellipse.alpha = 0.2,
                           cor.coef = TRUE,
                           method = "spearman",
                           cor.coef.coord = c(-5, 4),
                           conf.int = TRUE,
                           font.x = 15,
                           font.y = 15,
                           font.tickslab = c(12, "bold", "black"),
                           ellipse.border.remove = FALSE,
                           add = c("reg.line"),
                           add.params = list(color = "red"),
                           xlab = "RIP1 Expression (Z-score)",
                           ylab = "A20 Expression (Z-score)",
                           main = " ")
                           
A20_RIP1_DBS

ggsave("A20_RIP1_DBS.png", plot = A20_RIP1_DBS, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")


cluster2_acronyms <- rownames(A20_RIP1c)[dbs_A20_RIP1$cluster == 2]
cluster2_names <- ABA_ids$structure_name[ABA_ids$structure_acronym %in% cluster2_acronyms]

print(cluster2_names)

RIP1A20cor <- cor(A20RIP1data$TNFAIP3, A20RIP1data$RIPK1, method = "spearman")
RIP1A20cor

cluster1_points_A20RIP1<- A20_RIP1c[dbs_A20_RIP1$cluster == 1, ]

correlation_cluster1_A20RIP1 <- cor(cluster1_points_A20RIP1$RIPK1, cluster1_points_A20RIP1$TNFAIP3, method = "spearman")
correlation_cluster1_A20RIP1

```


# next generate regression fit with CI's on the A20 tlr4 Scatter plot

```{r}

# Calculate correlation coefficient
correlation <- cor(A20TLR4data$TLR4, A20TLR4data$TNFAIP3)

# Print the correlation coefficient
cat("Correlation coefficient:", correlation, "\n")

# Create the scatter plot with regression line
ggplot(A20TLR4data, aes(x = TLR4, y = TNFAIP3)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "TLR4", y = "TNFAIP3") +
  ggtitle("A20 vs TLR4 Expression")


# Calculate correlation coefficient
correlationAx <- cor(A20TLR4data$TNFAIP3, A20TLR4data$TLR4)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationAx, "\n")

# Create the scatter plot with regression line
ggplot(A20TLR4data, aes(x =TNFAIP3, y = TLR4)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "A20", y = "TLR4") +
  ggtitle("A20 vs TLR4 Expression")


```
# tlr4 vs myd88

```{r}
myd88TLR4data <- ABA_median[c("structure_acronym", "structure_name", "TLR4", "MYD88")]
rownames(myd88TLR4data) <- myd88TLR4data$structure_acronym
myd88TLR4data$structure_acronym <- NULL

# Create the scatter plot
ggplot(myd88TLR4data, aes(x = TLR4, y = MYD88)) +
  geom_point() +
  labs(x = "TLR4", y = "MYD88") +
  ggtitle("MYD88 vs TLR4 Expression") +
    theme_classic()

# Calculate correlation coefficient
correlationmyd88 <- cor(myd88TLR4data$MYD88, myd88TLR4data$TLR4, method = "spearman")

# Print the correlation coefficient
cat("Correlation coefficient:", correlationmyd88 , "\n")

# Create the scatter plot with regression line
myd88TLR4 = ggplot(myd88TLR4data, aes(x =TLR4, y = MYD88)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
   stat_cor(method = "spearman", label.x = 4, label.y = 3, size = 3, face = "bold") +
  labs(x = "TLR4 expression (median)", y = "MYD88 expression (median)") +
  ggtitle("") +
    theme_classic()
myd88TLR4

ggsave("myd88TLR4_sp.png", plot = myd88TLR4, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



```


TLR4 code comparison
```{r}
# Select TLR4 and all other genes from the ABA_median dataset
gene_data <- ABA_median[, 4:20123]

# Calculate correlation coefficients
correlations <- apply(gene_data, 2, function(x) cor(ABA_median$TLR4, x))

# Create a dataframe to store the correlation values
cor_data <- data.frame(Gene = colnames(gene_data), Correlation = correlations)

# Plot the correlation values
ggplot(cor_data, aes(x = Gene, y = Correlation)) +
  geom_bar(stat = "identity", fill = "skyblue", width = 0.8) +
  labs(x = "Genes", y = "Correlation with TLR4") +
  ggtitle("Correlation between TLR4 and Genes")

# Filter genes with correlation values equal to or greater than 0.5750084 or equal to or less than -0.5750084
TLR4similar_genes_pos  <- names(correlations[correlations >= 0.5750084])
TLR4similar_genes_neg <-  names(correlations[correlations <= -0.5750084])

# Print the genes with similar correlation values
TLR4similar_genes_pos
TLR4similar_genes_neg


```


trif scatter 
```{r}
TICAM1TLR4data <- ABA_median[c("structure_acronym", "structure_name", "TLR4", "TICAM1")]
rownames(TICAM1TLR4data) <- TICAM1TLR4data$structure_acronym
TICAM1TLR4data$structure_acronym <- NULL

# Create the scatter plot
TICAM1TLR4_sp = ggplot(TICAM1TLR4data, aes(x = TLR4, y = TICAM1)) +
  geom_point() +
  labs(x = "TLR4", y = "TRIF") +
  ggtitle("TRIF vs TLR4 Expression") +
    theme_classic()
TICAM1TLR4_sp

# Calculate correlation coefficient
correlationTICAM1 <- cor(TICAM1TLR4data$TICAM1, TICAM1TLR4data$TLR4)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationTICAM1 , "\n")

# Create the scatter plot with regression line
TICAM1TLR4_sp = ggplot(TICAM1TLR4data, aes(x =TLR4, y = TICAM1)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  stat_cor(method = "spearman", label.x = 6.5, label.y = 5.25, size = 3, face = "bold") +
  labs(x = "TLR4 expression (median)", y = "TRIF expression (median)") +
  ggtitle("") +
    theme_classic()
TICAM1TLR4_sp

ggsave("TICAM1TLR4_sp.png", plot = TICAM1TLR4_sp, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



```

```{r}

TICAM1_TLR4<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TLR4", "TICAM1")]

TICAM1_TLR4c <- TICAM1_TLR4[c("structure_acronym","TLR4", "TICAM1")]

rownames(TICAM1_TLR4c) <- TICAM1_TLR4c$structure_acronym
TICAM1_TLR4c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(TICAM1_TLR4c, k =2)
abline(h = 0.4, lty = 2)

dbs_TICAM1_TLR4 <- dbscan(TICAM1_TLR4c, eps = 0.4, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
TICAM1_TLR4_DBS = fviz_cluster(dbs_TICAM1_TLR4, data = TICAM1_TLR4c,
                            ellipse.type = "convex",
                            palette = LfAq_disc,
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "TLR4 Expression (Z-score)",
                            ylab = "TRIF Expression (Z-score)",
                            main = " ")

TICAM1_TLR4_DBS

# Extract the data points belonging to cluster 2
cluster2_points <- TICAM1_TLR4c[dbs_TICAM1_TLR4$cluster == 2, ]

# Get the labels of the points in cluster 2
cluster2_labels <- rownames(cluster2_points)

# Print the labels of points in cluster 2
print(cluster2_labels)

# Extract the data points belonging to cluster 3
cluster3_points <- TICAM1_TLR4c[dbs_TICAM1_TLR4$cluster == 3, ]

# Get the labels of the points in cluster 3
cluster3_labels <- rownames(cluster3_points)

# Print the labels of points in cluster 3
print(cluster3_labels)

# Extract the data points belonging to cluster 4
cluster4_points <- TICAM1_TLR4c[dbs_TICAM1_TLR4$cluster == 4, ]

# Get the labels of the points in cluster 4
cluster4_labels <- rownames(cluster4_points)

# Print the labels of points in cluster 4
print(cluster4_labels)


# Extract the data points belonging to cluster 1
cluster1_points_TICAM1TLR4<- TICAM1_TLR4c[dbs_TICAM1_TLR4$cluster == 1, ]

#correlation_cluster1_TICAM1TLR4 <- cor(cluster1_points_TICAM1TLR4$TLR4, cluster1_points_TICAM1TLR4$TICAM1, method = "spearman")

# Add correlation line to the plot (using geom_smooth)
TICAM1_TLR4_DBS_with_cor_line <- TICAM1_TLR4_DBS  +
  geom_smooth(data = cluster1_points_TICAM1TLR4, aes(x = TLR4, y = TICAM1), method = "lm", se = TRUE, color = "red", size = 0.5) +
stat_cor(data = cluster1_points_TICAM1TLR4, aes(x = TLR4, y = TICAM1), method = "spearman", label.x = 2.5, label.y = 4, size = 3, face = "bold")

TICAM1_TLR4_DBS_with_cor_line


ggsave("TICAM1_TLR4_DBS.png", plot = TICAM1_TLR4_DBS_with_cor_line, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



print(correlation_cluster1_TICAM1TLR4)

```

TRIF myd88

```{r}
TICAM1_MYD88<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "MYD88", "TICAM1")]

TICAM1_MYD88c <- TICAM1_MYD88[c("structure_acronym","MYD88", "TICAM1")]

rownames(TICAM1_MYD88c) <- TICAM1_MYD88c$structure_acronym
TICAM1_MYD88c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(TICAM1_MYD88c, k =2)
abline(h = 0.3, lty = 2)

dbs_TICAM1_MYD88 <- dbscan(TICAM1_MYD88c, eps = 0.3, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
TICAM1_MYD88_DBS = fviz_cluster(dbs_TICAM1_MYD88, data = TICAM1_MYD88c,
                            ellipse.type = "convex",
                            palette = LfAq_disc,
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "MYD88 Expression (Z-score)",
                            ylab = "TRIF Expression (Z-score)",
                            main = " ")

TICAM1_MYD88_DBS



# Extract the data points belonging to cluster 2
cluster2_points <- TICAM1_MYD88c[dbs_TICAM1_MYD88$cluster == 2, ]

# Get the labels of the points in cluster 2
cluster2_labels <- rownames(cluster2_points)

# Print the labels of points in cluster 2
print(cluster2_labels)

# Extract the data points belonging to cluster 3
cluster3_points <- TICAM1_MYD88c[dbs_TICAM1_MYD88$cluster == 3, ]

# Get the labels of the points in cluster 3
cluster3_labels <- rownames(cluster3_points)

# Print the labels of points in cluster 3
print(cluster3_labels)

# Extract the data points belonging to cluster 4
cluster4_points <- TICAM1_MYD88c[dbs_TICAM1_MYD88$cluster == 4, ]

# Get the labels of the points in cluster 4
cluster4_labels <- rownames(cluster4_points)

# Print the labels of points in cluster 
print(cluster4_labels)

# Extract the data points belonging to cluster 1
cluster1_points_TICAM1_MYD88<- TICAM1_MYD88c[dbs_TICAM1_MYD88$cluster == 1, ]

# Add correlation line to the plot (using geom_smooth)
TICAM1_MYD88_DBS_with_cor_line <- TICAM1_MYD88_DBS  +
  geom_smooth(data = cluster1_points_TICAM1_MYD88, aes(x = MYD88, y = TICAM1), method = "lm", se = TRUE, color = "red", size = 0.5) +
stat_cor(data = cluster1_points_TICAM1_MYD88, aes(x = MYD88, y = TICAM1), method = "spearman", label.x = -5, label.y = -4, size = 3, face = "bold")

TICAM1_MYD88_DBS_with_cor_line

ggsave("TICAM1_MYD88_DBS.png", plot = TICAM1_MYD88_DBS_with_cor_line, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")


correlation_cluster1_TICAM1_MYD88<- cor(cluster1_points_TICAM1_MYD88$MYD88, cluster1_points_TICAM1_MYD88$TICAM1)
print(correlation_cluster1_TICAM1_MYD88)


TICAM1MYD88data <- ABA_median[c("structure_acronym", "structure_name", "MYD88", "TICAM1")]
rownames(TICAM1MYD88data) <- TICAM1MYD88data$structure_acronym
TICAM1MYD88data$structure_acronym <- NULL

# Create the scatter plot
ggplot(TICAM1MYD88data, aes(x = MYD88, y = TICAM1)) +
  geom_point() +
  labs(x = "MYD88", y = "TRIF") +
  ggtitle("TRIF vs MYD88 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationTICAM1MYD88 <- cor(TICAM1MYD88data$TICAM1,TICAM1MYD88data$MYD88)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationTICAM1MYD88 , "\n")

# Create the scatter plot with regression line
TICAM1MYD88_SP = ggplot(TICAM1MYD88data, aes(x =MYD88, y = TICAM1)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  stat_cor(method = "spearman", label.x = 2.5, label.y = 5.5, size = 3, face = "bold") +
  labs(x = "MYD88 expression (median)", y = "TRIF expression (median)") +
  ggtitle("") +
    theme_classic()
TICAM1MYD88_SP
ggsave("TICAM1MYD88_SP.png", plot = TICAM1MYD88_SP, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")

```


A20 myd88

```{r}
myd88A20data <- ABA_median[c("structure_acronym", "structure_name", "TNFAIP3", "MYD88")]
rownames(myd88A20data) <- myd88A20data$structure_acronym
myd88A20data$structure_acronym <- NULL

# Create the scatter plot
ggplot(myd88A20data, aes(x = TNFAIP3, y = MYD88)) +
  geom_point() +
  labs(x = "A20", y = "MYD88") +
  ggtitle("MYD88 vs A20 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationmyd88A20 <- cor(myd88A20data$MYD88, myd88A20data$TNFAIP3)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationmyd88A20 , "\n")

# Create the scatter plot with regression line
ggplot(myd88A20data, aes(x =TNFAIP3, y = MYD88)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  stat_cor(method = "spearman", label.x = 3.5, label.y = 3, size = 3, face = "bold") +
  labs(x = "A20 expression (median)", y = "MYD88 expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))




MYD88_A20<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TNFAIP3", "MYD88")]

MYD88_A20c <- MYD88_A20[c("structure_acronym","TNFAIP3", "MYD88")]

rownames(MYD88_A20c) <- MYD88_A20c$structure_acronym
MYD88_A20c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(MYD88_A20c, k =2)
abline(h = 0.5, lty = 2)

dbs_MYD88_A20 <- dbscan(MYD88_A20c, eps = 0.5, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
MYD88_A20_DBS = fviz_cluster(dbs_MYD88_A20, data = MYD88_A20c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = TRUE,
                            cor.coef.coord = c(3, -4),
                            conf.int = TRUE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("reg.line"),
                            add.params = list(color = "red"),
                            xlab = "A20 Expression (Z-score)",
                            ylab = "MYD88 Expression (Z-score)",
                            main = " ")

MYD88_A20_DBS

# Extract the data points belonging to cluster 1
cluster1_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 1, ]

# Get the labels of the points in cluster 1 
cluster1_labelsMY <- rownames(cluster1_pointsMY)

# Print the labels of points in cluster 1
print(cluster1_labelsMY)

# Extract the data points belonging to cluster 2
cluster2_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 2, ]

# Get the labels of the points in cluster 2
cluster2_labelsMY <- rownames(cluster2_pointsMY)

# Print the labels of points in cluster 2
print(cluster2_labelsMY)

# Extract the data points belonging to cluster 3
cluster3_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 3, ]

# Get the labels of the points in cluster 3
cluster3_labelsMY <- rownames(cluster3_pointsMY)

# Print the labels of points in cluster 3
print(cluster3_labelsMY)

# Extract the data points belonging to cluster 4
cluster4_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 4, ]

# Get the labels of the points in cluster 4
cluster4_labelsMY <- rownames(cluster4_pointsMY)

# Print the labels of points in cluster 
print(cluster4_labelsMY)

# Extract the data points belonging to cluster 5
cluster5_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 5, ]

# Get the labels of the points in cluster 2
cluster5_labelsMY <- rownames(cluster5_pointsMY)

print(cluster5_labelsMY)

# Extract the data points belonging to cluster 1
cluster1_pointsMY <- MYD88_A20c[dbs_MYD88_A20$cluster == 1, ]


correlation_cluster1_MYD88_A20<- cor(cluster1_pointsMY$MYD88, cluster1_pointsMY$TNFAIP3)
print(correlation_cluster1_MYD88_A20)


```


tlr4 and traf6 


```{r}
TRAF6TLR4data <- ABA_median[c("structure_acronym", "structure_name", "TLR4", "TRAF6")]
rownames(TICAM1TLR4data) <- TRAF6TLR4data$structure_acronym
TRAF6TLR4data$structure_acronym <- NULL

# Create the scatter plot
ggplot(TRAF6TLR4data, aes(x = TLR4, y = TRAF6)) +
  geom_point() +
  labs(x = "TLR4", y = "TRAF6") +
  ggtitle("TRAF6 vs TLR4 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationTRAF6 <- cor(TRAF6TLR4data$TRAF6, TRAF6TLR4data$TLR4)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationTRAF6 , "\n")

# Create the scatter plot with regression line
ggplot(TRAF6TLR4data, aes(x =TLR4, y = TRAF6)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  stat_cor(method = "spearman", label.x = 4.2, label.y = 6.5, size = 3, face = "bold") +
  labs(x = "TLR4 expression (median)", y = "TRAF6 expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))



TRAF6_TLR4<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TLR4", "TRAF6")]

TRAF6_TLR4c <- TRAF6_TLR4[c("structure_acronym","TLR4", "TRAF6")]

rownames(TRAF6_TLR4c) <- TRAF6_TLR4c$structure_acronym
TRAF6_TLR4c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(TRAF6_TLR4c, k =3)
abline(h = 0.6, lty = 2)

dbs_TRAF6_TLR4 <- dbscan(TRAF6_TLR4c, eps = 0.6, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
TRAF6_TLR4_DBS = fviz_cluster(dbs_TRAF6_TLR4, data = TRAF6_TLR4c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(4.2, 6.5),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "TLR4 Expression (Z-score)",
                            ylab = "TRAF6 Expression (Z-score)",
                            main = " ")

TRAF6_TLR4_DBS
# Extract the data points belonging to cluster 1
cluster1_points_TRAF6_TLR4 <- TRAF6_TLR4c[dbs_TRAF6_TLR4$cluster == 1, ]
TRAF6_TLR4_DBS_with_cor_line <- TRAF6_TLR4_DBS  +
  geom_smooth(data = cluster1_points_TRAF6_TLR4, aes(x = TLR4, y = TRAF6), method = "lm", se = TRUE, color = "red", size = 0.5) +
stat_cor(data = cluster1_points_TRAF6_TLR4, aes(x = TLR4, y = TRAF6), method = "spearman", label.x = -5, label.y = 4, size = 3, face = "bold")

TRAF6_TLR4_DBS
TRAF6_TLR4_DBS_with_cor_line





correlation_cluster1_TRAF6_TLR4<- cor(cluster1_pointsTT$TRAF6, cluster1_pointsTT$TLR4)
print(correlation_cluster1_TRAF6_TLR4)




```

TRAF6 AND riPk1

```{r}
TRAF6RIPK1data <- ABA_median[c("structure_acronym", "structure_name", "RIPK1", "TRAF6")]
rownames(TRAF6RIPK1data) <- TRAF6RIPK1data$structure_acronym
TRAF6RIPK1data$structure_acronym <- NULL

# Create the scatter plot
ggplot(TRAF6RIPK1data, aes(x = RIPK1, y = TRAF6)) +
  geom_point() +
  labs(x = "TRAF6", y = "RIPK1") +
  ggtitle("TRAF6 vs RIPK1 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationTRAF6RIPK1 <- cor(TRAF6RIPK1data$TRAF6, TRAF6RIPK1data$RIPK1)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationTRAF6RIPK1 , "\n")

# Create the scatter plot with regression line
TRAF6RIPK1_sp = ggplot(TRAF6RIPK1data, aes(x =RIPK1, y = TRAF6)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  
stat_cor(method = "spearman", label.x = 5, label.y = 6.5, size = 3, face = "bold") + 
  
  labs(x = "RIP1 expression (median)", y = "TRAF6 expression (median)") +
  ggtitle("") +
    theme_classic()
TRAF6RIPK1_sp

ggsave("TRAF6RIPK1_sp.png", plot = TRAF6RIPK1_sp, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



TRAF6_RIPK1<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "RIPK1", "TRAF6")]

TRAF6_RIPK1c <- TRAF6_RIPK1[c("structure_acronym","RIPK1", "TRAF6")]

rownames(TRAF6_RIPK1c) <- TRAF6_RIPK1c$structure_acronym
TRAF6_RIPK1c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(TRAF6_RIPK1c, k =3)
abline(h = 0.6, lty = 2)

dbs_TRAF6_RIPK1 <- dbscan(TRAF6_RIPK1c, eps = 0.6, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
TRAF6_RIPK1_DBS = fviz_cluster(dbs_TRAF6_RIPK1, data = TRAF6_RIPK1c,
                            ellipse.type = "convex",
                            palette = LfAq_disc,
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "RIP1 Expression (Z-score)",
                            ylab = "TRAF6 Expression (Z-score)",
                            main = " ")

TRAF6_RIPK1_DBS

cluster1_pointsTRAF6_RIPK1<- TRAF6_RIPK1c[dbs_TRAF6_RIPK1$cluster == 1, ]

TRAF6_RIPK1_DBS_with_cor_line <- TRAF6_RIPK1_DBS  +
  geom_smooth(data = cluster1_pointsTRAF6_RIPK1, aes(x = RIPK1, y = TRAF6), method = "lm", se = TRUE, color = "red", size = 0.5) +
stat_cor(data = cluster1_pointsTRAF6_RIPK1, aes(x = RIPK1, y = TRAF6), method = "spearman", label.x = -5, label.y = 4, size = 3, face = "bold")

TRAF6_RIPK1_DBS_with_cor_line

ggsave("TRAF6_RIPK1_DBS.png", plot = TRAF6_RIPK1_DBS_with_cor_line, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")



#Outlierpoints

TRAF6_RIPK1_outliers <- TRAF6_RIPK1c[dbs_TRAF6_RIPK1$cluster == 0, ]

print(rownames(TRAF6_RIPK1_outliers))

# Extract the data points belonging to cluster 2
cluster2_pointsTR <- TRAF6_RIPK1c[dbs_TRAF6_RIPK1$cluster == 2, ]

# Get the labels of the points in cluster 2
cluster2_labelsTR <- rownames(cluster2_pointsTR)

# Print the labels of points in cluster 2
print(cluster2_labelsTR)


# Extract the data points belonging to cluster 3
cluster3_pointsTR <- TRAF6_RIPK1c[dbs_TRAF6_RIPK1$cluster == 3, ]

# Get the labels of the points in cluster 3
cluster3_labelsTR <- rownames(cluster3_pointsTR)

# Print the labels of points in cluster 3
print(cluster3_labelsTR)





correlation_cluster1TR <- cor(cluster1_pointsTR$RIPK1, cluster1_pointsTR$TRAF6)
correlation_cluster1TR




```











```{r}
gene_data <- ABA_median[, 4:20123]
correlation_matrix <- cor(gene_data, method ="spearman")

# Flatten the upper triangle of the correlation matrix (excluding the diagonal)
upper_triangle <- upper.tri(correlation_matrix)
correlation_values <- correlation_matrix[upper_triangle]
correlation_values <- round(correlation_values, 3)



set.seed(26)

correlation_values <- as.data.frame(correlation_values)

random_sample1 <- correlation_values[sample(nrow(correlation_values), size=20000000), ]

random_sample1 <- as.data.frame(random_sample1)

cor_histogram <- ggplot(random_sample1, aes(x=random_sample1)) + geom_histogram( binwidth=0.01, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
geom_vline(aes(xintercept = mean(random_sample1)), linetype = "dashed") +
theme(
  axis.text.x = element_text(face = "bold"),
    axis.text.y = element_text(face = "bold")) + 
xlab("correlation coefficient")

cor_histogram
summary(correlation_values)

library(moments)
skewness(correlation_values)


```



A20 gene comparison
```{r}

# Select A20 and all other genes from the ABA_median dataset
gene_data <- ABA_median[, 4:20123]

# Calculate correlation coefficients
correlations_A20 <- apply(gene_data, 2, function(x) cor(ABA_median$TNFAIP3, x))

# Create a dataframe to store the correlation values
cor_data_A20 <- data.frame(Gene = colnames(gene_data), Correlation = correlations_A20)

# Plot the correlation values
ggplot(cor_data_A20, aes(x = Gene, y = Correlation)) +
  geom_bar(stat = "identity", fill = "skyblue", width = 0.8) +
  labs(x = "Genes", y = "Correlation with A20") +
  ggtitle("Correlation between A20 and Genes")

# Filter genes with correlation values equal to or greater than 0.5750084 or equal to or less than -0.5750084
A20similar_genes_pos  <- names(correlations_A20[correlations_A20 >= 0.5750084])
A20similar_genes_neg <-  names(correlations_A20[correlations_A20 <= -0.5750084])

# Print the genes with similar correlation values
A20similar_genes_pos
A20similar_genes_neg



```
now lets look at a20 in the indetifed regions
```{r}
ABA_median_n <- ABA_median[, -c(1, 3)]

rownames(ABA_median_n) <- ABA_median_n$structure_name
ABA_median_n$structure_name <- NULL

```

```{r}
NGFRA20data <- ABA_median[c("structure_acronym", "structure_name", "TNFAIP3", "NGFR")]
rownames(NGFRA20data) <- NGFRA20data$structure_acronym
NGFRA20data$structure_acronym <- NULL

# Create the scatter plot
ggplot(NGFRA20data, aes(x = TNFAIP3, y = NGFR)) +
  geom_point() +
  labs(x = "A20", y = "NGFR") +
  ggtitle("NGFR vs A20 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationNGFRA20 <- cor(NGFRA20data$NGFR, NGFRA20data$TNFAIP3)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationNGFRA20 , "\n")

# Create the scatter plot with regression line
ggplot(NGFRA20data, aes(x =TNFAIP3, y = NGFR)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "A20 expression (median)", y = "NGFR expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))




NGFR_A20<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TNFAIP3", "NGFR")]

NGFR_A20c <- NGFR_A20[c("structure_acronym","TNFAIP3", "NGFR")]

rownames(NGFR_A20c) <- NGFR_A20c$structure_acronym
NGFR_A20c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(NGFR_A20c, k =3)
abline(h = 0.6, lty = 2)

dbs_NGFR_A20 <- dbscan(NGFR_A20c, eps = 0.6, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
NGFR_A20_DBS = fviz_cluster(dbs_NGFR_A20, data = NGFR_A20c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 6),
                            ylim = c(-5, 6),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "A20 Expression (Z-score)",
                            ylab = "NGFR Expression (Z-score)",
                            main = " ")

NGFR_A20_DBS




```
```{r}
MALT1A20data <- ABA_median[c("structure_acronym", "structure_name", "TNFAIP3", "MALT1")]
rownames(MALT1A20data) <- MALT1A20data$structure_acronym
MALT1A20data$structure_acronym <- NULL

# Create the scatter plot
ggplot(MALT1A20data, aes(x = TNFAIP3, y = MALT1)) +
  geom_point() +
  labs(x = "A20", y = "MALT1") +
  ggtitle("MALT1 vs A20 Expression") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))

# Calculate correlation coefficient
correlationMALT1A20 <- cor(MALT1A20data$MALT1, MALT1A20data$TNFAIP3)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationMALT1A20 , "\n")

# Create the scatter plot with regression line
ggplot(MALT1A20data, aes(x =TNFAIP3, y = MALT1)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "A20 expression (median)", y = "MALT1 expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))




MALT1_A20<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "TNFAIP3", "MALT1")]

MALT1_A20c <- MALT1_A20[c("structure_acronym","TNFAIP3", "MALT1")]

rownames(MALT1_A20c) <- MALT1_A20c$structure_acronym
MALT1_A20c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(MALT1_A20c, k =3)
abline(h = 0.5, lty = 2)

dbs_MALT1_A20 <- dbscan(MALT1_A20c, eps = 0.5, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
MALT1_A20_DBS = fviz_cluster(dbs_MALT1_A20, data = MALT1_A20c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 5),
                            ylim = c(-5, 5),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "A20 Expression (Z-score)",
                            ylab = "Malt1 Expression (Z-score)",
                            main = " ")

MALT1_A20_DBS



# Extract the data points belonging to cluster 2
cluster2_points <- MALT1_A20c[dbs_MALT1_A20$cluster == 2, ]

# Get the labels of the points in cluster 2
cluster2_labels <- rownames(cluster2_points)

# Print the labels of points in cluster 2
print(cluster2_labels)
```

orexin 
```{r}

HCRTdata <- ABA_median[c("structure_acronym", "structure_name", "HCRTR1", "HCRT")]
rownames(HCRTdata) <- HCRTdata$structure_acronym
HCRTdata$structure_acronym <- NULL

# Create the scatter plot with regression line
ggplot(HCRTdata, aes(x =HCRTR1, y = HCRT)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "HCRTR1 expression (median)", y = "HCRT expression (median)") +
  ggtitle("") +
    theme_classic()





HCRT<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "HCRTR1", "HCRT")]

HCRTc <- HCRT[c("structure_acronym","HCRTR1", "HCRT")]

rownames(HCRTc) <- HCRTc$structure_acronym
HCRTc$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(HCRTc, k =2)
abline(h = 0.4, lty = 2)

dbs_HCRT <- dbscan(HCRTc, eps = 0.4, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
HCRT_DBS = fviz_cluster(dbs_HCRT, data = HCRTc,
                            ellipse.type = "convex",
                            palette = LfAq_disc,
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-3, 7),
                            ylim = c(-3, 7),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "Orexin receptor 1 Expression (Z-score)",
                            ylab = "Orexin Expression (Z-score)",
                            main = "DBSCAN of Orexin and Orexin Receptor 1")

HCRT_DBS

#Outlierpoints

HCRT_outliers <- HCRTc[dbs_HCRT$cluster == 0, ]

print(rownames(HCRT_outliers))

# Calculate correlation coefficient
correlationHCRT <- cor(HCRTdata$HCRT, HCRTdata$HCRTR1)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationHCRT , "\n")

cluster1_pointsHCRT<- HCRTc[dbs_HCRT$cluster == 1, ]

correlation_clusterHCRT <- cor(cluster1_pointsHCRT$HCRT, cluster1_pointsHCRT$HCRTR1)
correlation_clusterHCRT

HCRT_DBS_with_cor_line <- HCRT_DBS  +
  geom_smooth(data = cluster1_pointsHCRT, aes(x = HCRTR1, y = HCRT), method = "lm", se = TRUE, color = "red", size = 0.5) +
stat_cor(data = cluster1_pointsHCRT, aes(x = HCRTR1, y = HCRT), method = "spearman", label.x = -2.5, label.y = -2, size = 3, face = "bold")
HCRT_DBS_with_cor_line


ggsave("OREXIN_dbscan.png", plot = HCRT_DBS_with_cor_line, width = 8, height = 4.5, path = "/Users/benbarry/Library/CloudStorage/Box-Box/PHD/Thesis/Chapter_2_ABA/figures")


```

```{r}
HCRTR2R1data <- ABA_median[c("structure_acronym", "structure_name", "HCRTR2", "HCRTR1")]
rownames(HCRTR2R1data) <- HCRTR2R1data$structure_acronym
HCRTR2R1data$structure_acronym <- NULL

# Create the scatter plot with regression line
ggplot(HCRTR2R1data, aes(x =HCRTR2, y = HCRTR1)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "HCRTR2 expression (median)", y = "HCRTR1 expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))





HCRTR2R1<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "HCRTR2", "HCRTR1")]

HCRTR2R1c <- HCRTR2R1[c("structure_acronym","HCRTR2", "HCRTR1")]

rownames(HCRTR2R1c) <- HCRTR2R1c$structure_acronym
HCRTR2R1c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(HCRTR2R1c, k =3)
abline(h = 0.4, lty = 2)

dbs_HCRTR2R1 <- dbscan(HCRTR2R1c, eps = 0.4, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
HCRTR2R1_DBS = fviz_cluster(dbs_HCRTR2R1, data = HCRTR2R1c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 7),
                            ylim = c(-5, 7),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "HCRTR2 Expression (Z-score)",
                            ylab = "HCRTR1 Expression (Z-score)",
                            main = " ")

HCRTR2R1_DBS

#Outlierpoints

HCRTR2R1_outliers <- HCRTR2R1c[dbs_HCRTR2R1$cluster == 0, ]

print(rownames(HCRTR2R1_outliers))

# Calculate correlation coefficient
correlationHCRTR2R1 <- cor(HCRTR2R1data$HCRTR2, HCRTR2R1data$HCRTR1)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationHCRTR2R1 , "\n")

cluster1_pointsHCRTR2R1<- HCRTR2R1c[dbs_HCRTR2R1$cluster == 1, ]

correlation_clusterHCRTR2R1 <- cor(cluster1_pointsHCRTR2R1$HCRTR2, cluster1_pointsHCRTR2R1$HCRTR1)
correlation_clusterHCRTR2R1

```
```{r}
HCRTR2data <- ABA_median[c("structure_acronym", "structure_name", "HCRTR2", "HCRT")]
rownames(HCRTR2data) <- HCRTR2data$structure_acronym
HCRTR2data$structure_acronym <- NULL

# Create the scatter plot with regression line
ggplot(HCRTR2data, aes(x =HCRTR2, y = HCRT)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "HCRTR2 expression (median)", y = "HCRT expression (median)") +
  ggtitle("") +
    theme(plot.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 20, 20, 20, unit = "pt"))





HCRTR2<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "HCRTR2", "HCRT")]

HCRTR2c <- HCRTR2[c("structure_acronym","HCRTR2", "HCRT")]

rownames(HCRTR2c) <- HCRTR2c$structure_acronym
HCRTR2c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(HCRTc, k =3)
abline(h = 0.4, lty = 2)

dbs_HCRTR2 <- dbscan(HCRTR2c, eps = 0.4, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
HCRTR2_DBS = fviz_cluster(dbs_HCRTR2, data = HCRTR2c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 7),
                            ylim = c(-5, 7),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "HCRTR2 Expression (Z-score)",
                            ylab = "HCRT Expression (Z-score)",
                            main = " ")

HCRTR2_DBS

#Outlierpoints

HCRTR2_outliers <- HCRTR2c[dbs_HCRTR2$cluster == 0, ]

print(rownames(HCRTR2_outliers))

# Calculate correlation coefficient
correlationHCRTR2 <- cor(HCRTR2data$HCRT, HCRTR2data$HCRTR2)

# Print the correlation coefficient
cat("Correlation coefficient:", correlationHCRTR2 , "\n")

cluster1_pointsHCRTR2<- HCRTR2c[dbs_HCRTR2$cluster == 1, ]

correlation_clusterHCRTR2 <- cor(cluster1_pointsHCRTR2$HCRT, cluster1_pointsHCRTR2$HCRTR2)
correlation_clusterHCRTR2

```
Cluster analysis of A20 genes - GO terms
```{r}
library(clusterProfiler)


# Convert gene symbols to Entrez IDs
A20similar_genes_pos <- mapIds(org.Hs.eg.db, keys = A20similar_genes_pos, column = "ENTREZID", keytype = "SYMBOL")
# Convert gene symbols to Entrez IDs
A20similar_genes_neg <- mapIds(org.Hs.eg.db, keys = A20similar_genes_neg, keytype = "SYMBOL", column = "ENTREZID")

# Entrez gene ID


ego <- enrichGO(gene          = A20similar_genes_pos$ENTREZID,
              keyType       = "ENTREZID",
                OrgDb         = org.Hs.eg.db,
                ont           = "BP",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05,
        readable      = TRUE)
head(ego)


goplot(ego, title = "A20 positivly correlated genes")


ego2 <- enrichGO(gene         = A20similar_genes_neg,
                OrgDb         = org.Hs.eg.db,
                keyType       = "ENTREZID",
                ont           = "BP",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05)
goplot(ego2, title = "A20 negativly correlated genes")

```


Bcell vs a20 
```{r}
CD19<- ABA_zscore[c("structure_id", "structure_name", "structure_acronym", "CD19", "MS4A1")]

CD19c <- CD19[c("structure_acronym","CD19", "MS4A1")]

rownames(CD19c) <- CD19c$structure_acronym
CD19c$structure_acronym <- NULL

#to search for region names:
ABA_ids <- ABA_zscore[c("structure_id", "structure_name","structure_acronym")]

#KNN dist plot 
dbscan::kNNdistplot(CD19c, k =3)
abline(h = 0.75, lty = 2)

dbs_CD19<- dbscan(CD19c, eps = 0.75, minPts = 3)

# Visualize
library("factoextra")
library(ggrepel)
CD19_DBS = fviz_cluster(dbs_CD19, data = CD19c,
                            ellipse.type = "convex",
                            palette = "jco",
                            fill = "grey",
                            ggtheme = theme_classic(),
                            geom = c("point", "text"),
                            show.clust.cent = FALSE,
                            repel = FALSE,
                            xlim = c(-5, 7),
                            ylim = c(-5, 7),
                            xticks.by = 2,
                            yticks.by = 1,
                            pointsize = 2,
                            labelsize = 0,
                            outlier.labelsize = 10.0,
                            outlier.pointsize = 2,
                            outlier.color = "black",
                            ellipse.alpha = 0.2,
                            cor.coef = FALSE,
                            cor.coef.coord = c(3, 3),
                            conf.int = FALSE,
                            font.x = 15,
                            font.y = 15,
                            font.tickslab = c(12, "bold", "black"),
                            ellipse.border.remove = FALSE,
                            add = c("none"),
                            add.params = list(color = "red"),
                            xlab = "CD19 Expression (Z-score)",
                            ylab = "CD20 Expression (Z-score)",
                            main = " ")

CD19_DBS




```





```{r}

# Convert gene symbols to Entrez IDs
TLR4similar_genes_pos <- mapIds(org.Hs.eg.db, keys = TLR4similar_genes_pos, keytype = "SYMBOL", column = "ENTREZID")

TLR4similar_genes_neg <- mapIds(org.Hs.eg.db, keys = TLR4similar_genes_neg, keytype = "SYMBOL", column = "ENTREZID")


TLR4ego <- enrichGO(gene          = TLR4similar_genes_pos,
              keyType       = "ENTREZID",
                OrgDb         = org.Hs.eg.db,
                ont           = "BP",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05,
        readable      = TRUE)
head(TLR4ego)

TLR4ego2 <- enrichGO(gene         = TLR4similar_genes_neg,
                OrgDb         = org.Hs.eg.db,
                keyType       = "ENTREZID",
                ont           = "BP",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05)
head(TLR4ego2) 



goplot(TLR4ego, title = "TLR4 positivly corelated genes")

goplot(TLR4ego2, title = "TLR4 negativly corelated genes")




```

KEGG pathways
```{}
kk <- enrichKEGG(gene         = A20similar_genes_pos$ENTREZID,
                 organism     = 'hsa',
                 pvalueCutoff = 0.05)
head(kk)

kk2 <- gseKEGG(geneList     = A20similar_genes_pos$ENTREZID,
               organism     = 'hsa',
               minGSSize    = 120,
               pvalueCutoff = 0.05,
               verbose      = FALSE)
head(kk2)

mkk <- enrichMKEGG(gene = A20similar_genes_pos$ENTREZID,
                   organism = 'hsa',
                   pvalueCutoff = 1,
                   qvalueCutoff = 1)
head(mkk) 
dotplot(mkk)

```


``` {r}
library(ReactomePA)
# A20 up reactome 
A20up <- enrichPathway(gene=A20similar_genes_pos$ENTREZID, pvalueCutoff = 0.05, readable=TRUE)
head(A20up)
dotplot(A20up, title = "A20 positivly corellated genes")

#A20 down reactome
A20down <- enrichPathway(gene=A20similar_genes_neg, pvalueCutoff = 0.05, readable=TRUE)
head(A20down)
dotplot(A20down, title = "A20 negativly corellated genes")

#TLR4 up reactome
TLR4up <- enrichPathway(gene=TLR4similar_genes_pos, pvalueCutoff = 0.05, readable=TRUE)
dotplot(TLR4up, title = "TLR4 positivly corellated genes")

#TLR4 down reactome
TLR4down <- enrichPathway(gene=TLR4similar_genes_neg, pvalueCutoff = 0.05, readable=TRUE)
head(TLR4down)
dotplot(TLR4down, title = "TLR4 negativly corellated genes")

```


```{r}
library(enrichplot)
library(DOSE)
edoA20up <- enrichDGN(A20similar_genes_pos$ENTREZID)
dotplot(edoA20up, showCategory=30, title = "A20 positivly correlated genes") 

edoA20down <- enrichDGN(A20similar_genes_neg)
dotplot(edoA20down, showCategory=30, title = "A20 neg correlated genes") 

edoTLR4up <- enrichDGN(TLR4similar_genes_pos)
dotplot(edoTLR4up, showCategory=30, title = "TLR4 positivly correlated genes") 

edoTLR4down <- enrichDGN(TLR4similar_genes_neg)
dotplot(edoTLR4down, showCategory=30, title = "TLR4 nagativly correlated genes") 


```

WIKIpathways
```{}
A20_wiki <- enrichWP(A20similar_genes_pos$ENTREZID, organism = "Homo sapiens")
dotplot(A20_wiki, title = "A20 Positivly correlated genes")


TLR4_wiki <- enrichWP(TLR4similar_genes_pos$ENTREZID, organism = "Homo sapiens")
dotplot(TLR4_wiki, title = "TLR4 positivly corelated genes")
```